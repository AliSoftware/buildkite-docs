#!/bin/bash
set -euo pipefail

# TODO: move to env
EMAIL="chris.c+docbot@buildkite.com"
NAME="buildkite-docs-bot"

echo "+++ Configure git"
git config --global user.email $EMAIL
git config --global user.name $NAME

# echo "+++ Download GraphQL schema"
# buildkite-agent artifact download "schema.json" "docs/data/graphql_data_schema.json" --build $BUILDKITE_TRIGGERED_FROM_BUILD_ID

# if [[ -z "$(git status --porcelain)" ]]; then
#   echo "No changes to commit"
#   exit 0
# fi

echo "+++ Generate GraphQL docs"
# ./scripts/generate-graphql-api-content.sh

echo "+++ Check for changes"
# SCHEMA_HASH=$(git rev-parse --short :data/graphql_data_schema.json)
BRANCH=graphql-schema-update-$(date +%s)

echo "--- Commit and push changes"
git checkout -b $BRANCH
git add .
git commit -m "Update GraphQL docs" --allow-empty # fixme: this is temporary, until we have a schema change
# git commit -m "Update GraphQL docs"

echo "+++ Push changes"
git push -u origin $BRANCH

# echo "+++ Create pull request"
# gh pr create --title "Update GraphQL schema" --body "This PR updates the GraphQL schema to the latest version." --base master --head graphql-schema-update-$(date +%Y-%m-%d)

